#!/usr/bin/env bash
set -e

# Script para parar todos os serviÃ§os de desenvolvimento

# Cores
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

log_info() {
  echo -e "${BLUE}â„¹ ${NC} $1"
}

log_success() {
  echo -e "${GREEN}âœ“${NC} $1"
}

log_warn() {
  echo -e "${YELLOW}âš ${NC} $1"
}

echo -e "${YELLOW}"
cat << "EOF"
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   ğŸ›‘ Encerrando ServiÃ§os                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EOF
echo -e "${NC}"

# Detectar docker compose (v2 - novo) ou docker-compose (v1 - antigo)
if docker compose version &> /dev/null 2>&1; then
  DOCKER_COMPOSE="docker compose"
elif command -v docker-compose &> /dev/null && docker-compose version &> /dev/null 2>&1; then
  DOCKER_COMPOSE="docker-compose"
else
  log_warn "Docker Compose nÃ£o encontrado. Pulando parada de containers."
  DOCKER_COMPOSE=""
fi

# Parar processos Rails e Node.js
log_info "Parando Backend Rails..."
pkill -f "rails server" 2>/dev/null && log_success "Backend encerrado" || log_warn "Backend nÃ£o estava rodando"

log_info "Parando Frontend Next.js..."
pkill -f "next dev" 2>/dev/null && log_success "Frontend encerrado" || log_warn "Frontend nÃ£o estava rodando"

# Parar containers Docker
if [ -n "$DOCKER_COMPOSE" ]; then
  log_info "Parando containers Docker..."
  $DOCKER_COMPOSE down
else
  log_warn "Docker Compose nÃ£o disponÃ­vel. Containers nÃ£o foram parados."
fi

log_success "\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
log_success "  Todos os serviÃ§os foram encerrados"
log_success "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
